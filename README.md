# Summary
因資料量太大需要將資料分組，分組依照天分組。
組織partition sql，尋找資料搬遷的解決分案。

# Solution
### 資料轉移步驟為 :
##### 1.CREATE TABLE
```
--資料來源
CREATE TABLE TEST_SOURCE_TABLE
(
    ID        VARCHAR2(48) not null primary key,
    CREATE_TIME_DATE  DATE
);

--DO PARTITION TABLE
CREATE TABLE TEST_TARGET_TABLE
(
    ID        VARCHAR2(48) not null primary key,
    CREATE_TIME_DATE  DATE
)PARTITION BY RANGE (CREATE_TIME_DATE)
INTERVAL (NUMTODSINTERVAL(1, 'DAY'))
(
   PARTITION PART_01 values LESS THAN (TO_DATE('2000-01-01','YYYY-MM-DD'))
);
```

##### 2.建立測試資料(3100萬筆)
```
declare v_cnt number := 0;
begin
for i in 1 .. 1000000 loop
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-01 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-02 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-03 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-04 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-05 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-06 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-07 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-08 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-09 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-10 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-11 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-12 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-13 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-14 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-15 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-16 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-17 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-18 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-19 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-20 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-21 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-22 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-23 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-24 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-25 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-26 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-27 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-28 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-29 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-30 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO TEST_SOURCE_TABLE (ID, CREATE_TIME_DATE) VALUES (SYS_GUID(), TO_DATE('2022-05-31 13:41:11', 'YYYY-MM-DD HH24:MI:SS'));
    v_cnt := v_cnt + 1;
    
    --commit per 5000
    if mod(v_cnt, 5000) = 0 then
         commit;
         end if;
end loop;
commit;
end;
```
##### 3.將TEST_SOURCE_TABLE匯進TEST_TARGET_TABLE
```
 INSERT /*+ APPEND PARALLEL */ INTO TEST_TARGET_TABLE (ID, CREATE_TIME_DATE)
SELECT /*+ PARALLEL */* FROM TEST_SOURCE_TABLE;
```

# verify
#### 查詢資料表 PARTITION
```
SELECT PARTITION_NAME,HIGH_VALUE FROM USER_TAB_PARTITIONS t WHERE TABLE_NAME='TEST_TARGET_TABLE';
```
#### 確認資料是否有進PARTITION
```
SELECT * FROM TEST_TARGET_TABLE PARTITION ({partition_name});
```
